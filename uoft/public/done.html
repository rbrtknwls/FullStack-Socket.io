<html>
    <head>
        <title>CredID</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    </head>
    <style>
        @import 'https://fonts.googleapis.com/css?family=Roboto+Mono:100';
        h1{
          font-family: 'Roboto Mono', monospace;
          font-size: 75px;
        }
        h4{
          font-family: 'Roboto Mono', monospace;

        }
        .centerdiv {
          min-height: 100%; 
          min-height: 100vh;    

          display: flex;
          align-items: center;
          justify-content: center;
        }
        body{
           height: 100%;
            background-color: #ffffff;
            background-image:linear-gradient(310deg, rgba(55,10,60,0.35) 30%, rgba(0, 228, 255, 0.35));
            background-size: cover;
            background-color: rgba(0, 0, 0, 0.2);
        }
        .btn-side{
            background-color: #8064A2 !important;
            color: white !important;
        }
        #videoElement {
            width: 700px;
            height: 525px;
            background-color: #666;
        }
        #video_overlays {
            position:absolute;
            z-index:300000;
            text-align:center;
        }
        
    </style>
<body>
    
<div class="centerdiv">
    <div class="jumbotron" style="padding-bottom: 20px">
        <canvas id = "video_overlays" width = 700px height="525px"></canvas>
        <video autoplay="true" id="videoElement" width= 600px>
        </video>
        <div id="capturedimage"></div>
          <div class = "row " style="text-align: center;margin-top: 3vh">
            <div class="col-4 mx-auto">
                 <a class="btn btn-side btn-lg" style = "text-decoration-color: white" href="#" role="button">Take a Photo</a>   
            </div>
          </div>
    </div>
          
</div>
</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
    var video = document.querySelector("#videoElement");
    var image = $("#capturedimage");
    var socket = io.connect();
    
    setInterval(function(){
        getimg();
    },500)
    function getimg(){
        var canvas = document.createElement("canvas");
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

        var img = document.createElement("img");
        var data = canvas.toDataURL();
        
        
        var base64Image = data.replace(/^data:image\/png;base64,/, '');
        socket.emit("fbbox", base64Image);
    }
    
    

    if (navigator.mediaDevices.getUserMedia) {
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function (stream) {
          video.srcObject = stream;
        });

    }
    
    socket.on('returnbbox', function (bbox) {
        var canvas = document.getElementById("video_overlays");
        
        var width = bbox["Width"]*canvas.width/2;
        var height = bbox["Height"]*canvas.height/2;
        var top = bbox["Top"]*canvas.height;
        var left = bbox["Left"]*canvas.width;
        
        
        
        var ctx = canvas.getContext('2d');
        
        ctx.clearRect(0,0,canvas.width, canvas.height)
        
        ctx.lineWidth = 5;
        var gradient = ctx.createLinearGradient(0, 0, canvas.width/2, 0);
        gradient.addColorStop("0", 'rgb(0, 228, 255)');
        gradient.addColorStop("1.0", 'rgb(55,10,60)');
        ctx.strokeStyle = gradient;
        
        ctx.beginPath();
        ctx.ellipse(left + width, top + height, width, height,0,0,360);
        ctx.stroke();

        console.log("-----");
        
    });

</script>
</html>
